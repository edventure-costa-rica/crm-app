<% form_for([@client, @trip, @reservation]) do |f| %>
  <%= f.error_messages %>

  <p>
    <%= f.label :trip_id %><br />
    <%= f.hidden_field :trip_id %>
    <b><%= @trip %></b><br/>
    <%= t '.trip_duration' %>:
    <em><%= @trip.nights %></em><br/>
    <%= h l @trip.arrival.to_date %> &ndash;
    <%= h l @trip.departure.to_date %>
  </p>

  <p>
    <%= f.label :client %><br />
    <b><%= @client %></b>
  </p>

  <% javascript_tag do -%>
  function getData(region_id) {
    <%= remote_function(
          :url  => companies_path({ :format => :js }),
          :with => "'region_id='+region_id",
          :method => :get
        )
    %>
  }

  function loadData(data) {
    var select = $('company-select');

    // clear
    while (select.length > 0) select.remove(0);

    // add
    if (data.length > 0) {
      select.enable();

      for (var i = 0; i < data.length; i++) {
        select.insert(
          new Element('option', { value: data[i].value }).
            update(data[i].label)
        );
      }
    }

    // no data
    else {
      select.disable();
      alert(<%= t('.empty_region').to_json %>);
    }
  }
  <% end %>

  <p>
    <%= f.label :region %><br />
    <b><%=select :reservation, :region_id,
            Region.ordered.map { |r| [r.name, r.id] },
            { :prompt   => t('.select_region') },
            { :id       => 'region-select',
              :name     => '',
              :onchange => 'getData(this.value)'
            }
    %></b>
  </p>

  <p>
    <%= f.label :company %><br />
    <%= f.select :company_id, 
          Company.all_in_region( @reservation.region_id ).
            map { |c| [ c.name, c.id ] },
          { :prompt => t('.select_region') },
          { :id => 'company-select' }
    %>
  </p>
  <p>
    <%= f.label :reservation_id %><br />
    <%= f.text_field :reservation_id %>
  </p>
  <p>
    <%= f.label :arrival %><br />
    <%= f.datetime_select :arrival %>
  </p>
  <p>
    <%= f.label :pickup_location %><br />
    <%= f.text_field :pickup_location %>
  </p>
  <p>
    <%= f.label :departure %><br />
    <%= f.datetime_select :departure %>
  </p>
  <p>
    <%= f.label :dropoff_location %><br />
    <%= f.text_field :dropoff_location %>
  </p>
  <p>
    <%= f.label :net_price %><br />
    <%= f.text_field :net_price %>
  </p>
  <p>
    <%= f.label :price %><br />
    <%= f.text_field :price %>
  </p>
  <p>
    <%= f.label :services %><br />
    <%= f.text_area :services, :rows => 3 %>
  </p>
  <p>
    <%= f.label :notes %><br />
    <%= f.text_area :notes %>
  </p>
  <p>
    <%= f.submit submit_text %>
  </p>
<% end %>
